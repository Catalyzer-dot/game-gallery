services:
  # Go后端服务
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.linux # 使用Linux版本（推荐，体积小）
      # dockerfile: Dockerfile     # 如果必须用Windows容器，改用这一行
    container_name: game-gallery-backend
    ports:
      - '8080:8080'
    env_file:
      - ./backend/.env
    # volumes:
    #   - ./backend:/app # 开发时热重载（需在macOS上会覆盖编译的二进制文件）
    networks:
      - game-gallery-network
    restart: unless-stopped

  # 前端服务（可选，如果前端也要Docker化）
  frontend:
    build:
      context: ./web
      dockerfile: Dockerfile # 需要创建web/Dockerfile
    container_name: game-gallery-frontend
    ports:
      - '5173:5173'
    environment:
      - VITE_API_URL=
    networks:
      - game-gallery-network
    restart: unless-stopped
    depends_on:
      - backend

  # Nginx反向代理（可选）
  nginx:
    image: nginx:latest
    container_name: game-gallery-nginx
    ports:
      - '80:80'
      - '443:443'
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
      - ./certs:/etc/nginx/certs:ro # SSL证书（如需HTTPS）
    networks:
      - game-gallery-network
    depends_on:
      - backend
      - frontend
    restart: unless-stopped

networks:
  game-gallery-network:
    driver: bridge
